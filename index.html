<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>Show Up</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
body{
font-family:system-ui;
background:#f4efe9;
margin:0;
padding:1rem;
color:#222;
}

h1{text-align:center;margin-bottom:1rem;}

.panel{
background:white;
padding:1rem;
border-radius:14px;
margin-bottom:1rem;
box-shadow:0 4px 10px rgba(0,0,0,.05);
}

input,button,select{
width:100%;
padding:.7rem;
margin-top:.5rem;
font-size:1rem;
}

button{
border:none;
border-radius:10px;
background:#6b7b6b;
color:white;
}

#gearButton{
position:fixed;
top:12px;
right:12px;
width:44px;
height:44px;
background:white;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:20px;
box-shadow:0 4px 10px rgba(0,0,0,.15);
cursor:pointer;
z-index:1000;
}

#lockScreen{
position:fixed;
inset:0;
background:#111;
color:white;
display:none;
align-items:center;
justify-content:center;
text-align:center;
padding:2rem;
z-index:999;
}

#lockBox{max-width:320px;}
#lockBox button{margin-top:.6rem;}
</style>

</head>

<body>

<div id="gearButton">⚙️</div>

<h1>Show up.</h1>

<!-- Progress -->

<div class="panel">
<h3>Today</h3>
<div style="width:100%;height:18px;background:#ddd;border-radius:10px;overflow:hidden;">
<div id="dayBar" style="
height:100%;
width:0%;
background:linear-gradient(90deg,#4caf50,#ff5252);
transition:.3s;"></div>
</div>
</div>

<!-- Task Input -->

<div class="panel">

<input id="taskTitle" placeholder="What are you supposed to do?">
<input id="taskTime" type="time">
<input id="taskDuration" type="number" placeholder="Duration (minutes)">

<select id="taskType">
<option value="wake">Wake up</option>
<option value="shower">Shower</option>
<option value="exercise">Exercise</option>
<option value="music">Music work</option>
<option value="project">Project work</option>
<option value="youtube">Limit YouTube</option>
<option value="general">General</option>
</select>

<select id="taskRepeat">
<option value="none">One time</option>
<option value="daily">Daily</option>
<option value="weekdays">Weekdays</option>
<option value="weekends">Weekends</option>
<option value="interval">Every X days</option>
</select>

<input id="repeatInterval"
type="number"
placeholder="X days"
style="display:none;">

<button onclick="addTask()">Commit</button>

</div>

<!-- Task List -->

<div class="panel" id="taskList">
<p>No commitments yet.</p>
</div>

<!-- Lock Screen -->

<div id="lockScreen">
<div id="lockBox">
<h2 id="lockText"></h2>

<button onclick="respondCompleted()">I did it</button> <button onclick="respondPartial()">I started</button> <button onclick="respondAvoided()">I avoided it</button> <button onclick="respondOverwhelmed()">I was overwhelmed</button> <button onclick="respondReschedule()">Reschedule</button>

</div>
</div>

<script>

/* ---------- LOAD ---------- */

let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
tasks = tasks.filter(t => t.duration);

/* ---------- REPEAT UI ---------- */

document.getElementById("taskRepeat")
.addEventListener("change",e=>{
document.getElementById("repeatInterval")
.style.display=
e.target.value==="interval"?"block":"none";
});

/* ---------- STATE ---------- */

let activeTask=null;

/* ---------- SAVE ---------- */

function save(){
localStorage.setItem("tasks", JSON.stringify(tasks));
render();
updateDayBar();
}

/* ---------- ADD TASK ---------- */

function addTask(){

let title=document.getElementById("taskTitle").value;
let time=document.getElementById("taskTime").value;
let duration=parseInt(document.getElementById("taskDuration").value);
let type=document.getElementById("taskType").value;
let repeat=document.getElementById("taskRepeat").value;
let interval=parseInt(
document.getElementById("repeatInterval").value
)||null;

if(!title||!time||!duration)return;

let now=new Date();
let [h,m]=time.split(":");
now.setHours(h,m,0,0);

tasks.push({
id:Date.now(),
title,
type,
start:now.getTime(),
duration,
repeat,
repeatInterval:interval,
template:true,
done:false,
response:null,
escalation:0,
lastPrompt:0,
day:new Date().toDateString()
});

save();
}

/* ---------- RENDER ---------- */

function render(){

let list=document.getElementById("taskList");
list.innerHTML="";

let active=tasks.filter(t=>!t.done && !t.template);

if(active.length===0){
list.innerHTML="<p>No commitments yet.</p>";
return;
}

active.forEach(t=>{

let end=new Date(t.start+(t.duration*60000));

let div=document.createElement("div");
div.textContent=
`[${t.type}] `+
t.title+
" — ends "+
end.toLocaleTimeString([],{
hour:'2-digit',
minute:'2-digit'
});

list.appendChild(div);

});
}

/* ---------- SPAWN RECURRING ---------- */

function spawnRecurring(){

let now=new Date();

tasks
.filter(t=>t.template)
.forEach(t=>{

let shouldSpawn=false;

let day=now.getDay();

if(t.repeat==="daily")shouldSpawn=true;

if(t.repeat==="weekdays" && day>0 && day<6)
shouldSpawn=true;

if(t.repeat==="weekends" && (day===0||day===6))
shouldSpawn=true;

if(t.repeat==="interval" && t.repeatInterval){

let last=new Date(t.start);
let diff=Math.floor(
(now-last)/(1000*60*60*24)
);

if(diff>=t.repeatInterval)
shouldSpawn=true;
}

if(shouldSpawn){

let exists=tasks.some(x=>
!x.template &&
x.title===t.title &&
new Date(x.day).toDateString()===
now.toDateString()
);

if(!exists){

tasks.push({
...t,
id:Date.now(),
template:false,
start:new Date(
now.setHours(
new Date(t.start).getHours(),
new Date(t.start).getMinutes(),
0,0
)
).getTime(),
done:false,
response:null,
escalation:0,
lastPrompt:0,
day:new Date().toDateString()
});

}
}

});

save();
}

/* ---------- CHECK ---------- */

function checkTasks(){

let now=Date.now();

tasks.forEach(t=>{

if(t.done||t.template)return;

let endTime=t.start+(t.duration*60000);

if(now>endTime){

activeTask=t;

document.getElementById("lockText").innerText=
`[${t.type}] missed\n\n${t.title}`;

document.getElementById("lockScreen").style.display="flex";

}

});
}

/* ---------- RESPONSES ---------- */

function respondCompleted(){
activeTask.done=true;
activeTask.response="completed";
closeLock();
save();
}

function respondPartial(){
activeTask.response="partial";
closeLock();
save();
}

function respondAvoided(){
activeTask.response="avoided";
closeLock();
save();
}

function respondOverwhelmed(){
activeTask.response="overwhelmed";
closeLock();
save();
}

function respondReschedule(){
activeTask.response="rescheduled";
activeTask.start=Date.now()+30*60000;
closeLock();
save();
}

function closeLock(){
document.getElementById("lockScreen").style.display="none";
}

/* ---------- PROGRESS ---------- */

function updateDayBar(){

let today=new Date().toDateString();

let todayTasks=tasks.filter(t=>
t.day===today && !t.template
);

if(todayTasks.length===0){
document.getElementById("dayBar").style.width="0%";
return;
}

let score=0;

todayTasks.forEach(t=>{
if(t.response==="completed")score+=1;
else if(t.response==="avoided")score-=1;
});

let percent=((score+todayTasks.length)/
(2*todayTasks.length))*100;

document.getElementById("dayBar").style.width=
Math.max(0,percent)+"%";
}

/* ---------- START ---------- */

spawnRecurring();
setInterval(checkTasks,60000);
setInterval(spawnRecurring,3600000);

render();
updateDayBar();

</script>

</body>
</html>
