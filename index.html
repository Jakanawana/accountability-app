<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>Show Up</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
body{
font-family:system-ui;
background:#f4efe9;
margin:0;
padding:1rem;
color:#222;
}

h1{
text-align:center;
margin-bottom:1rem;
}

.panel{
background:white;
padding:1rem;
border-radius:14px;
margin-bottom:1rem;
box-shadow:0 4px 10px rgba(0,0,0,.05);
}

input,button{
width:100%;
padding:.7rem;
margin-top:.5rem;
font-size:1rem;
}

button{
border:none;
border-radius:10px;
background:#6b7b6b;
color:white;
}

#lockScreen{
position:fixed;
inset:0;
background:#111;
color:white;
display:none;
align-items:center;
justify-content:center;
text-align:center;
padding:2rem;
z-index:999;
}

#lockBox{
max-width:320px;
}

#lockBox button{
margin-top:.8rem;
}
  #gearButton{
position:fixed;
top:12px;
right:12px;
width:44px;
height:44px;
background:white;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:20px;
box-shadow:0 4px 10px rgba(0,0,0,.15);
cursor:pointer;
z-index:1000;
user-select:none;
}

</style>

</head>

<body>
  
<div id="gearButton">
⚙️
</div>


<h1>Show up.</h1>

<div class="panel">
<input id="taskTitle" placeholder="What are you supposed to do?">
<input id="taskTime" type="time">
<input id="taskDuration" type="number" placeholder="Duration (minutes)">
<button onclick="addTask()">Commit</button>
</div>

  <div class="panel">
<h3>Today</h3>
<div style="
width:100%;
height:18px;
background:#ddd;
border-radius:10px;
overflow:hidden;
">
<div id="dayBar" style="
height:100%;
width:0%;
background:linear-gradient(90deg,#4caf50,#ff5252);
transition:.3s;
"></div>
</div>
</div>

<div class="panel" id="taskList"></div>

  <div id="optionsPanel" style="
display:none;
position:fixed;
inset:0;
background:#000c;
color:white;
z-index:998;
padding:2rem;
">

<h2>Options</h2>

<label>
<input type="checkbox" id="testToggle">
 Enable Test Mode
</label>

<div id="testControls" style="display:none;margin-top:1rem;">
<button onclick="devTrigger()">Trigger test lock</button>
<button onclick="devEscalate()">Escalate test lock</button>
<button onclick="devReset()">Reset test escalation</button>
</div>

<br><br> <button onclick="toggleOptions()">Close</button>

</div>

  <div id="optionsPanel" style="
display:none;
position:fixed;
inset:0;
background:#000c;
color:white;
z-index:998;
padding:2rem;
">

<h2>Options</h2>

<label>
<input type="checkbox" id="testToggle">
 Enable Test Mode
</label>

<div id="testControls" style="display:none;margin-top:1rem;">
<button onclick="devTrigger()">Trigger test lock</button>
<button onclick="devEscalate()">Escalate test lock</button>
<button onclick="devReset()">Reset test escalation</button>
</div>

<br><br> <button onclick="toggleOptions()">Close</button>

</div>

<div id="lockScreen">
<div id="lockBox">
<h2 id="lockText"></h2>
<button onclick="startTask()">I’m doing it now</button>
<button onclick="completeTask()">I finished it</button>
<button onclick="avoidTask()">I avoided it</button>
</div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
let activeTask = null;

function save(){
localStorage.setItem("tasks", JSON.stringify(tasks));
render();
  updateDayBar();

}

function addTask(){

let title=document.getElementById("taskTitle").value;
let time=document.getElementById("taskTime").value;
let duration=parseInt(document.getElementById("taskDuration").value);

if(!title||!time||!duration)return;

let now=new Date();
let [h,m]=time.split(":");
now.setHours(h,m,0,0);

tasks.push({
id:Date.now(),
title,
start:now.getTime(),
duration,
done:false,
escalation:0,
avoids:0,
lastPrompt:0,
day:new Date().toDateString()
});


save();
}

function render(){
let list=document.getElementById("taskList");
list.innerHTML="";

if(tasks.length===0){
list.innerHTML="<p>No commitments yet.</p>";
return;
}

tasks.forEach(t=>{
if(t.done)return;

let end=new Date(t.start+(t.duration*60000));

let div=document.createElement("div");
div.textContent=
t.title+
" — ends "+end.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})+
(t.avoids>0?` (avoided ${t.avoids}x)`:"");

list.appendChild(div);
});
}

function checkTasks(){
let now=Date.now();

tasks.forEach(t=>{
if(t.done)return;

let endTime=t.start+(t.duration*60000);

if(now>endTime){

if(!t.lastPrompt){
t.lastPrompt=now;
triggerLock(t);
}

else if(now - t.lastPrompt > 10*60000){
t.escalation++;
t.lastPrompt=now;
triggerLock(t);
}

}
});
}

function triggerLock(task){
activeTask=task;

let tones=[
"You said you’d do this.",
"You’re avoiding it.",
"Still not moving.",
"This keeps happening.",
"We’re not letting this slide."
];

document.getElementById("lockText").innerText=
tones[Math.min(task.escalation,tones.length-1)]
+"\n\n"+task.title;

document.getElementById("lockScreen").style.display="flex";
}

function startTask(){
document.getElementById("lockScreen").style.display="none";

setTimeout(()=>{
activeTask.escalation++;
triggerLock(activeTask);
},5*60000);
}

function avoidTask(){

activeTask.avoids++;

if(activeTask.avoids>=2){

document.getElementById("lockText").innerText=
"You’ve avoided this multiple times.\n\nWe’re not rescheduling it again.";

return;
}

activeTask.start=Date.now()+15*60000;
activeTask.lastPrompt=0;

document.getElementById("lockScreen").style.display="none";

save();
}

setInterval(checkTasks,60000);

render();
  /* ---------- OPTIONS PANEL LOGIC ---------- */

let optionsOpen=false;

function toggleOptions(){

let panel=document.getElementById("optionsPanel");

if(!panel)return;

optionsOpen=!optionsOpen;

panel.style.display=optionsOpen?"block":"none";

}

/* ---------- TEST MODE ---------- */

let testTask={
title:"Test task",
escalation:0,
avoids:0
};

document.addEventListener("change",e=>{
if(e.target.id==="testToggle"){
document.getElementById("testControls").style.display=
e.target.checked?"block":"none";
}
});

function devTrigger(){
triggerLock(testTask);
}

function devEscalate(){
testTask.escalation++;
triggerLock(testTask);
}

function devReset(){
testTask.escalation=0;
alert("Test escalation reset.");
}

/* ---------- GEAR BUTTON CLICK ---------- */

document.getElementById("gearButton")
.addEventListener("click",toggleOptions);

  function completeTask(){

activeTask.done=true;

document.getElementById("lockScreen").style.display="none";

save();
updateDayBar();
}

  function updateDayBar(){

let today=new Date().toDateString();

let todayTasks=tasks.filter(t=>t.day===today);

if(todayTasks.length===0){
document.getElementById("dayBar").style.width="0%";
return;
}

let score=0;

todayTasks.forEach(t=>{
if(t.done)score+=1;
else if(t.avoids>=2)score-=1;
});

let percent=((score+todayTasks.length)/
(2*todayTasks.length))*100;

document.getElementById("dayBar").style.width=
Math.max(0,percent)+"%";
}

</script>

</body>
</html>





